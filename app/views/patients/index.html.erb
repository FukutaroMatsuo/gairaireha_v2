<% provide(:title, '患者一覧') %>
<div class="row">
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 今年度の新患基本データ</h5>
  </div>
  
  <div class="col s12 m12 l12">
    <div class="card blue-grey darken-1">
      <div class="card-content white-text">
        <table class="centered">
          <thead>
            <tr>
              <th style="width: 20%;">今月</th>
              <th style="width: 20%;">今年度</th>
              <th style="width: 20%;">今年度の目標達成率</th>
              <th style="width: 20%;">1ヶ月継続率</th>
              <th style="width: 20%;">3ヶ月継続率</th>
            </tr>
          </thead>
        </table>
      
        <div class="table-body-patient">
          <table class="centered">
            <tbody>
              <tr>
                <td style="width: 20%;"><%= @this_month_patient %>人</td>
                <td style="width: 20%;"><%= @this_year_patient %>人</td>
                <td style="width: 20%;"><%= @goal_achievement %>%</td>
                <td style="width: 20%;"><%= @one_month %>%</td>
                <td style="width: 20%;"><%= @three_month %>%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 今年度の全新患目標</h5>
  </div>
  
  <div class="col s12 m12 l12">
    <div class="card white darken-1">
      <div class="card-content">
        <table class="centered">
          <thead>
            <tr>
              <th style="width: 15%;">患者名</th>
              <th style="width: 15%;">開始日</th>
              <th style="width: 60%;">一ヶ月目標</th>
              <th style="width: 10%;">達成</th>
            </tr>
          </thead>
        </table>
      
        <div class="table-body-patient">
          <table class="centered">
            <% @new_patient.each do |patient| %>
              <tbody>
                <tr>
                  <td style="width: 15%;"><%= link_to patient.patient_name, edit_patient_path(patient.id) %></td>
                  <td style="width: 15%;"><%= patient.start_day %></td>
                  <td style="width: 60%;"><%= patient.goal %></td>
                  <td style="width: 10%;"><%= patient.achievement %></td>
                </tr>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 今月来院していない患者<strong style="margin-left: 50px;"><%= @drop_out.count %></strong>人</h5>
  </div>
  
  <div class="col s12 m12 l12">
    <div class="card white darken-1">
      <div class="card-content">
        <table class="centered">
          <thead>
            <tr>
                <th style="width: 10%;">患者名</th>
                <th style="width: 10%;">年齢</th>
                <th style="width: 10%;">最終日</th>
                <th style="width: 10%;">担当PT</th>
                <th style="width: 60%;">理由</th>
            </tr>
          </thead>
        </table>
      
        <div class="table-body-patient">
          <table class="centered">
            <% @drop_out.each do |d| %>
              <tbody>
                <tr>
                  <td style="width: 10%;"><%= link_to d.patient_name, edit_patient_path(d.id) %></td>
                  <td style="width: 10%;"><%= (Date.today.strftime('%Y%m%d').to_i - d.birthday.strftime('%Y%m%d').to_i) / 10000 %></td>
                  <td style="width: 10%;"><%= d.rehas.last.day %></td>
                  <td style="width: 10%;"><%= d.user.name %></td>
                  <td style="width: 60%;"><%= d.drop_out %></td>
                </tr>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 中止者一覧<strong style="margin-left: 50px;"><%= @drop_out_prev_month.count %></strong>人</h5>
  </div>
  
  <div class="col s12 m12 l12">
    <div class="card white darken-1">
      <div class="card-content">
        <table class="centered">
          <thead>
            <tr>
                <th style="width: 10%;">患者名</th>
                <th style="width: 10%;">年齢</th>
                <th style="width: 10%;">最終日</th>
                <th style="width: 10%;">担当PT</th>
                <th style="width: 60%;">理由</th>
            </tr>
          </thead>
        </table>
      
        <div class="table-body-patient">
          <table class="centered">
            <% @drop_out_prev_month.each do |d| %>
              <tbody>
                <tr>
                  <td style="width: 10%;"><%= link_to d.patient_name, edit_patient_path(d.id) %></td>
                  <td style="width: 10%;"><%= (Date.today.strftime('%Y%m%d').to_i - d.birthday.strftime('%Y%m%d').to_i) / 10000 %></td>
                  <td style="width: 10%;"><%= d.rehas.last.day %></td>
                  <td style="width: 10%;"><%= d.user.name %></td>
                  <td style="width: 60%;"><%= d.drop_out %></td>
                </tr>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 今月の来院患者一覧<strong style="margin-left: 50px;"><%= @now_patients.count %></strong>人</h5>
  </div>

  <div class="col s12 m12 l12">
    <div class="card white darken-1">
      <div class="card-content">
        <table class="centered">
          <thead>
            <tr>
                <th style="width: 15%;">患者名</th>
                <th style="width: 10%;">年齢</th>
                <th style="width: 15%;">地域</th>
                <th style="width: 15%;">開始日</th>
                <th style="width: 15%;">疾患別</th>
                <th style="width: 15%;">担当PT</th>
                <th style="width: 15%;">合計単位数</th>
            </tr>
          </thead>
        </table>
      
        <div class="table-body-patient">
          <table class="centered">
            <% @now_patients.each do |patient| %>
              <tbody>
                <tr>
                  <td style="width: 15%;"><%= link_to patient.patient_name, edit_patient_path(patient.id) %></td>
                  <td style="width: 10%;"><%= (Date.today.strftime('%Y%m%d').to_i - patient.birthday.strftime('%Y%m%d').to_i) / 10000 %></td>
                  <td style="width: 15%;"><%= patient.area %></td>
                  <td style="width: 15%;"><%= patient.start_day %></td>
                  <td style="width: 15%;"><%= patient.deasease %></td>
                  <td style="width: 15%;"><%= patient.user.name %></td>
                  <td style="width: 15%;"><%= patient.rehas.sum(:unit) %></td>
                </tr>
              </tbody>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <h5><i class="material-icons gray-text">timeline</i> 今月の来院患者の分類</h5>
  </div>
  
  <div class="col s12 m6 l6">
    <div class="card white darken-1">
      <div class="data">
        <div class="card-title center-align">疾患別</div>
        <div class="card-content">
          <%= pie_chart @patient_deasease, discrete: true %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m6 l6">
    <div class="card white darken-1">
      <div class="data">
        <div class="card-title center-align">PT別</div>
        <div class="card-content">
          <%= pie_chart @patient_pt, discrete: true %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12 m12 l12">
    <div class="card white darken-1">
      <div class="data">
        <div class="card-title center-align">地域別</div>
        <div class="card-content">
          <%= column_chart @patient_area, discrete: true, colors: ["#00CC33"] %>
        </div>
      </div>
    </div>
  </div>

</div>